%\chapter{det-comp}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Anode Plane Assemblies}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Cathode Plane Assemblies}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Field Cage}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{HV components}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{TPC front-end electronics and DAQ}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{PDS front-end electronics and DAQ}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Cryostat and feedthroughs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Cryostat and LAr purification system}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Detector monitoring and slow control}
\label{sec:slowcontrol}

The scope of the ProtoDUNE detector control system includes the design, procurement, fabrication, testing,
delivery, installation oversight and acceptance tests of a comprehensive detector monitoring, control and safety system.
%, fulfilling the needs of the protoDUNE detectors and experiment's infrastructure.

The responsibility for the system is split between ProtoDUNE-SP and CERN: 
\begin{itemize}
\item	The ProtoDUNE-SP collaboration is responsible for all the devices that will be installed and cabled inside 
the cryostat, the sensors needed to monitor the cryostat itself, and the specifications for the system needs.
\item	CERN is responsible for the implementation of the control system (hardware, firmware and software) outside the cryostat.
\end{itemize}

This section describes the main system requirements, %will be described in terms of 
constraints and assumptions,  %and functional requirements; 
%and the sensors, power supplies, etc. foreseen for protoDUNE will be detailed 
and the general structure of 
the control system and its components. %will be described.

The design of the ProtoDUNE-SP safety and control system is based on the experience gained in collaboration with ETH Zurich during a pilot (WA105) project. The components of this system and their functions are as follows:
\begin{itemize}
\item	The Process Control System (PCS) reads temperature sensors, pressure sensors, trace analysers (O$_2$, N$_2$, H$_2$O).
\item	The Detector Control System (DCS) monitors and controls the low voltage (LV) and high voltage (HV).
\item	The Detector Safety System (DSS) ensures the safety of the experiment by performing the temperature surveys and monitoring interlocks.
\end{itemize}
The system will provide a graphical user interface to visualize the trends of monitored values, the alarms, as well as to control the experiment. A web interface will allow remote monitoring of the behavior of the experiment.

%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Constraints and requirements}

\fixme{I'm not sure how much of this you want here. It would be better to list the half-dozen or so most important requirements then describe the system and its operation. Anne}

\begin{enumerate}
\item	The control and safety system for SP protoDUNE shall be based on the experience gained, the design developed and the 
components chosen for the 3mx1mx1m WA105 DP protoDUNE prototype.
\item	The control and safety system for SP protoDUNE shall be prepared, commissioned and installed on the timescales 
required by the experiment.

\item	The physical interface of the system taken care of by CERN is at the level of the outer flanges on the cryostat. 
Sensors, power distribution, etc. inside the cryostat are part of the experiment's responsibilities, while CERN will take 
care of connecting the control system to the flanges.
\item	The slow control group is not responsible for the site and peripheral infrastructure (cables, patch panels, 
platforms, safety items, Power 400V, UPS, etc.).
\item	The system specification (I/O parameters, control \& safety logics, etc.) is provided by the SP protoDUNE 
collaboration.
\item	The system developed by CERN will interface to the cryogenic control infrastructure for information and signal 
exchanges. 
\item	The final test and commissioning in building 887 (EHN1, Prevessin) will be carried out jointly by the SP protoDUNE 
collaboration and EP/DT-DI.
\item	A person from the SP protoDUNE collaboration will work side by side with CERN to contribute to the SCADA 
supervisor and user interface developments and ensure regular information exchange.

\item	CERN shall design, procure components, construct and test the control and safety system according to the SP protoDUNE specifications.
\item	CERN shall develop and test the SCADA supervisor for SP protoDUNE.
\item	CERN shall deliver a complete set of technical documentation, comprising technical drawings, hardware components lists, installation and commissioning instructions, operations instructions and hand-over documents.
\item	CERN shall participate to the final test and commissioning of the system in building 887 (EHN1, Prevessin).
\item	The Process Control System shall do the reading of temperature sensors, pressure sensors, trace analysers (O2, N2, H2O).
\item	The Detector Control System shall monitor and control the LV and HV.
\item	The Detector Safety System shall ensure the safety of the experiment.
\item	The Detector Safety System shall perform the temperature survey.
\item	The Detector Safety System shall take care of interlocks.
\item	The system shall provide a graphical user interface to visualize the trends of monitored values, the alarms, as well as to control the experiment.
\item	The system should provide a web interface to be able to remotely monitor the behaviour of the experiment.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Devices}
Add here PMT \& TPC (HV, LV, current monitors?), temperature and pressure sensors, level meters?, camera vision inside tank?, trace analysers, 
calibration system?,... 

\fixme{missing}
%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{General layout of the detector control and safety system}

%moved to front The design of the ProtoDUNE-SP control system is based on the experience gained in collaboration with ETH Zurich during a pilot (WA105) project aimed at validating, among others, the design of the control system for such types of detectors. 

Figure \ref{fig:dcsdesign} shows the general architecture of the control and safety system for ProtoDUNE-SP.
The system is subdivided into the Process Control System (PCS), the Detector Control System (DCS) and the Detector Safety System (DSS). \fixme{Remove the following; not needed here: For the ProtoDUNE-DP detector an additional element is included for the motorization of the Charge Readout Plane (CRP).}

\begin{cdrfigure}[DCS design]{dcsdesign}{Proposed architecture and technical solution of the control and safety system.}
%\includegraphics[width=0.8\textwidth, angle=90]{DCS_Design}
\includegraphics[width=1.\textwidth]{DCS_Design}
\end{cdrfigure}

The control system for each detector will be composed of the following elements:
\begin{enumerate}
\item	A chassis for electrical distribution (380Vac, 220Vac, 24Vdc redundant).
\item	Two chassis for PCS composed of an FPGA, signal conditioners, interface, and cabling.
\item	One chassis for DCS  composed of an interface for LV/HV monitoring \& control.
\item	A chassis for DSS composed of an FPGA and relays for the safety of the experiment.
\item	A chassis for a PC data acquisition \& supervision (PVSS SCADA Supervisor) composed of a computer with a display monitor, a switch and a 
server.
\item	Four chassis for the remote I/O to capture signal close to the detector and avoid multi-cabling structure.
\item	One chassis for HV controlled by the slow control system.
\end{enumerate}
All these elements, will be mounted in the 19-in. racks (see Figure \ref{fig:dcsracks}).
\begin{cdrfigure}[DCS racks]{dcsracks}{Proposed racks layout of the control and safety system.}
\includegraphics[width=0.6\textwidth]{DCS-distant-racks}
\includegraphics[width=0.6\textwidth]{DCS-proximity-racks}
\end{cdrfigure}

The supervisory software will by based on the JCOP framework \fixme{(add ref.)}, originally developed for the LHC experiments at CERN and now used in several more experiments at CERN. Besides providing a supervisory control and data acquisition system, the framework offers many tools for the implementation of finite state machines, archival of data, as well as graphical interfaces as web dashboards.


